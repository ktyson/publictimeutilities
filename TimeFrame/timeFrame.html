<html>
<head>
<meta charset="utf-8">

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>

<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.0/jquery-ui.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/ui-lightness/jquery-ui.css" type="text/css" media="all" />


<script src='spectrum.js'></script>
<link rel='stylesheet' href='spectrum.css' />
    
    
<script>

var weekStartDate = new Date("2014-01-26 00:00:00");
var owner = "kdtyson";
var currColor;
var spans = {};


$(document).ready(function(){
	
	makePalette();
	makeFrame();
    makeControls();
    makeEventHandlers();
	

	$(".span").on("hover click", function(){
		
		if(event.which == 1) {
			var id = $(this).attr("id")
			//alert("span " + id);
		
			$(this).css("background-color", currColor);
		
			if(!spans[id]) {
				spans[id] = {};
			} 
			spans[id].color = currColor;
		}
	
	});
	
	$(".colorspan").on("click", function(){
	
		
		currColor = $(this).css("background-color");
		
	
	});
	

});

var timeType = {};
timeType["kdtyson"] = {"choices": {}};
timeType["kdtyson"].choices["#00ff00"] =
		{level_1 : "TRC-Drisco",
		level_2 : "Maintenance",
		level_3 : "General",		
		hidden : false,
		activatedDate : "",
		closedDate : ""	
};
timeType["kdtyson"].choices["#0000ff"] =
		{level_1 : "TRC-Bethel",
		level_2 : "Maintenance",
		level_3 : "General",		
		hidden : false,
		activatedDate : "",
		closedDate : ""	
};
timeType["kdtyson"].choices["#ff0000"] =
		{level_1 : "TT",
		level_2 : "Maintenance",
		level_3 : "General",		
		hidden : false,
		activatedDate : "",
		closedDate : ""	
};

function makePalette() {

	var c = [];
	
	c.push("<table class='palette'><tr>");

		c.push("<td>");
		c.push("<div class='colorspan' style='background-color:white'></div>");		
		c.push("</td>");
	
	for(var color in timeType["kdtyson"].choices) {
		c.push("<td>");
		c.push("<div class='colorspan' style='background-color:" + color + "'></div>");		
		c.push("</td>");
	} 
	
	c.push("</tr></table>");
	
	$("#palette").html(c.join(''));

}

function makeFrame() {	

	var c = [];
	
	c.push("<table class='tablespan'>");
	
	c.push("<tr>");
	c.push("<td></td>");
	
	for(var h = 0; h < 24*2; h++) {
						
		//trim hours
		if(Math.abs(24 - h) < 12) {
				
			if(h % 2) {
				c.push("<th>" + "-" + "</th>");
			} else {
				c.push("<th>" + h/2 + "</th>");
			}
		
		}

	}
	c.push("</tr>");
	
	for (var d = 0; d < 7; d++) {
		
		c.push("<tr>");
		
		c.push("<td>" + getDayLabel(d) + "</td>");
		
			for(var h = 0; h < 24*2; h++) {
			
				//trim hours
				if(Math.abs(24 - h) < 12) {
					var id = "d_" + d + "_h_" + h/2;
	
					c.push("<td><div id='" + id + "' class='span'></div></td>");
				}
			}
	
		c.push("</tr>");

	}
	
	c.push("</table>");
	
	$("#calendar").html(c.join(''));
	
	
	$("#display").html(weekStartDate.toString());

}

function getDayLabel(dayNum) {

	var days = ["Su","M","T","W","Th","F","Sa"];
	
	return days[dayNum];
}
    
    
function makeControls() {
    
    var c = [];
    
    c.push("<div>");
    
    c.push("Choose Color: <input type='text' id='customcolor' />");
    c.push("  Name: <input size='30' id='selectProjectName' />");
    c.push("<input id='addChoice' type='button' value='Add'></input>");
    
    c.push("</div><div>");
    
    c.push("<input id='writeReport' type='button' value='Report'></input>");
    c.push("<input id='writeObject' type='button' value='Object'></input>");
    
    c.push("</div>");
    
    $("#control").html(c.join(''));
    
    
    $("#customcolor").spectrum({
        color: "#ff0000",
        showInput: true,
        preferredFormat: "hex6",
        showButtons: false
    });
    
    
}
    
function makeEventHandlers() {
    
    $("#writeReport").on("click", function() {
        
        
        
        $("#report").html("test rep");
        
    });

    $("#writeObject").on("click", function() {

        var c = [];
        
        c.push(JSON.stringify(spans));
        c.push(JSON.stringify(timeType));
               
        $("#report").html(c.join("\n\n"));
        
    });
    
    
    $("#addChoice").on("click", function() {
        
        alert($("#customcolor").val());
        
    });
    
    
    
    
}

$.cssHooks.backgroundColor = {
    get: function(elem) {
        if (elem.currentStyle)
            var bg = elem.currentStyle["backgroundColor"];
        else if (window.getComputedStyle)
            var bg = document.defaultView.getComputedStyle(elem,
                null).getPropertyValue("background-color");
        if (bg.search("rgb") == -1)
            return bg;
        else {
            bg = bg.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
            function hex(x) {
                return ("0" + parseInt(x).toString(16)).slice(-2);
            }
            return "#" + hex(bg[1]) + hex(bg[2]) + hex(bg[3]);
        }
    }
}



</script>

<style>

table.tablespan td {
    background-color: whte;
}

table.tablespan {
    border-collapse: separate;
    border-spacing: 0px;
    *border-collapse: expression('separate', cellSpacing = '10px');
}


.span {
	border: solid thin black;
	width: 20px;
	height: 20px;
}
.colorspan {
	border: solid thin black;
	width: 20px;
	height: 20px;
}

</style>

</head>
<body>
<div id="control"></div>
<div id="display"></div>
<div id="palette"></div>
<div id="calendar"></div>
<div id="report"></div>
</body>
</html>